{
  "title": "Ralph 2.0 - Simplified Multi-Agent Loop",
  "version": "2.0.0",
  "status": "proposed",
  "created": "2026-01-11",
  "updated": "2026-01-11",
  "author": "Analysis of multi-agent-ralph-loop + community SOTA practices",
  "overview": {
    "summary": "Refactor Ralph to incorporate the best features from multi-agent-ralph-loop AND community-proven SOTA practices while keeping it dramatically simpler, maintaining Codex CLI compatibility, and embracing a modular architecture.",
    "philosophy": "Ralph should be a lightweight loop orchestrator, not a heavy framework. Features should be opt-in modules, not mandatory infrastructure. Named after the Simpsons character for its 'persistently dumb but undeterred' approach to retrying until success.",
    "keyDifferentiator": "Unlike multi-agent-ralph-loop which is tightly coupled to Claude Code with 185+ skills, Ralph 2.0 remains agent-agnostic with pluggable quality checks and circuit breakers.",
    "coreInsight": "Each iteration starts fresh, re-anchoring from source files (PRD, git state, specs). Accumulated errors don't pollute future runs. Memory persists only through git commits, progress.txt, and checkpoint files."
  },
  "communityWisdom": {
    "description": "SOTA best practices extracted from high-engagement X posts by Matt Pocock (4.6k likes), Greg Isenberg (2.7k likes), Geoffrey Huntley, Gordon Mickel (894 likes), Arvid Kahl (1.6k likes), and others.",
    "keyPrinciples": [
      {
        "principle": "Atomic Task Breakdown",
        "source": "Greg Isenberg, Matt Pocock",
        "insight": "Spend 1+ hours on PRD upfront. Convert to JSON stories with 'passes: false' flags. One feature per iteration prevents failures from overambitious scopes."
      },
      {
        "principle": "Fresh Context Per Iteration",
        "source": "Gordon Mickel, Geoffrey Huntley, Anthropic guidance",
        "insight": "Unlike single-session plugins, external loops with file I/O as state prevent context rot. Re-anchor to maintain accuracy over long runs."
      },
      {
        "principle": "Cumulative Learning",
        "source": "Matt Pocock, Arvid Kahl",
        "insight": "Agents commit work and append summaries to progress.txt. Failures become cumulative improvements. Prevents redundant errors in extended loops."
      },
      {
        "principle": "Multi-Layered Quality Gates",
        "source": "Gordon Mickel, Hamel Husain",
        "insight": "Incorporate reviews from multiple models. Block on failures rather than flagging. CI stays green, bug propagation reduced."
      },
      {
        "principle": "Circuit Breakers",
        "source": "ralph-orchestrator (Mikey O'Brien), Geoffrey Huntley",
        "insight": "Limits like MAX_CONSECUTIVE_FAILURES=3 prevent waste. Output analysis on stuck states for human intervention."
      },
      {
        "principle": "Planning Before Coding",
        "source": "Gordon Mickel, MIT Recursive Language Models (Alex L Zhang, 3.8k likes)",
        "insight": "Separate plan phase from work phase. Agent self-reviews plan first, catching logical issues early before implementation."
      },
      {
        "principle": "Adversarial Feedback",
        "source": "Bitstein, Robert Youssef (364 likes), Block AI paper",
        "insight": "Coach-player or multi-agent debates. One agent critiques another's output. Reduces hallucinations by 10-25% per MIT studies."
      }
    ]
  },
  "currentState": {
    "files": [
      "scripts/ralph/ralph.sh - Main loop (~70 lines)",
      "scripts/ralph/prompt.md - Agent instructions",
      "scripts/ralph/prd.json - Task list with user stories",
      "scripts/ralph/progress.txt - Learning accumulator"
    ],
    "strengths": [
      "Simple bash loop that just works",
      "Agent-agnostic via RALPH_AGENT_CMD",
      "Memory through git + text files (elegant)",
      "Small context window per iteration (smart)",
      "Fresh context prevents drift"
    ],
    "weaknesses": [
      "No quality validation between iterations",
      "No iteration limits or circuit breakers",
      "Binary pass/fail without priority ordering",
      "No automatic PRD breakdown",
      "No stuck-state detection",
      "No planning phase separation",
      "No parallel execution support"
    ]
  },
  "multiAgentRalphLoopAnalysis": {
    "featuresWorthAdopting": [
      {
        "feature": "Quality Gates",
        "value": "9-language validation (TS, Python, Go, Rust, etc.)",
        "simplification": "Single script, runs only when enabled via RALPH_QUALITY_GATES=1",
        "effort": "small"
      },
      {
        "feature": "Iteration Limits",
        "value": "Prevents infinite loops, model-aware limits",
        "simplification": "Simple env vars: MAX_ITERATIONS, RALPH_MODEL_LIMIT_CODEX=25",
        "effort": "small"
      },
      {
        "feature": "Task Schema Enhancement",
        "value": "Priority ordering, dependencies, status tracking",
        "simplification": "Extend prd.json with optional priority/dependencies fields",
        "effort": "small"
      },
      {
        "feature": "VERIFIED_DONE Signal",
        "value": "Explicit completion signal after validation",
        "simplification": "Keep <promise>COMPLETE</promise>, add optional post-validation",
        "effort": "small"
      },
      {
        "feature": "Progress Format Standardization",
        "value": "Structured learnings that compound across iterations",
        "simplification": "Formalize progress.txt format in prompt.md",
        "effort": "small"
      },
      {
        "feature": "Git Safety Guard",
        "value": "Blocks destructive git commands (force push, reset --hard)",
        "simplification": "Optional pre-command validator, ~50 lines",
        "effort": "small"
      }
    ],
    "featuresToAvoid": [
      {
        "feature": "Claude Code Dependency",
        "reason": "User wants Codex CLI compatibility, not Claude-only"
      },
      {
        "feature": "8-Step Orchestrator",
        "reason": "Over-engineered; simple loop + good prompt achieves same result"
      },
      {
        "feature": "185 Global Skills",
        "reason": "Massive complexity; modular scripts are simpler"
      },
      {
        "feature": "Complex Hooks Infrastructure",
        "reason": "settings.json with PreToolUse/PostToolUse/etc is Claude-specific"
      },
      {
        "feature": "Global Install System",
        "reason": "Ralph should be project-local, not system-wide"
      }
    ]
  },
  "proposedArchitecture": {
    "structure": {
      "scripts/ralph/": {
        "ralph.sh": "Main loop (enhanced, ~200 lines)",
        "prompt.md": "Agent instructions (enhanced format)",
        "prd.json": "Enhanced task schema",
        "progress.txt": "Learnings accumulator"
      },
      "scripts/ralph/modules/": {
        "quality-gates.sh": "Optional language validation",
        "git-guard.sh": "Optional git safety check",
        "checkpoint.sh": "Optional state persistence",
        "circuit-breaker.sh": "Optional stuck-state detection",
        "prd-generator.sh": "Optional PRD auto-breakdown",
        "planner.sh": "Optional planning phase",
        "reviewer.sh": "Optional adversarial review",
        "parallel.sh": "Optional parallel execution via worktrees",
        "monitor.sh": "Optional real-time monitoring"
      },
      "scripts/ralph/templates/": {
        "prd-template.json": "Starting point for new PRDs",
        "prompt-template.md": "Starting point for prompts",
        "progress-template.txt": "Progress format guide"
      }
    },
    "principles": [
      "Zero dependencies beyond bash, git, jq (optional)",
      "All modules are opt-in via environment variables",
      "Works with any CLI agent (Codex, Claude, custom)",
      "Single file can run the entire loop",
      "Templates help users get started quickly",
      "Fresh context per iteration (no drift)",
      "Circuit breakers prevent runaway costs"
    ]
  },
  "userStories": [
    {
      "id": "US-001",
      "title": "Enhanced Task Schema",
      "description": "Extend prd.json to support priorities, dependencies, and richer status tracking",
      "priority": 1,
      "source": "multi-agent-ralph-loop + Greg Isenberg (2.7k likes)",
      "acceptanceCriteria": [
        "prd.json supports priority field (1-10, lower = higher priority)",
        "prd.json supports dependencies array (task IDs that must complete first)",
        "prd.json supports status: pending | in_progress | completed | blocked | failed",
        "ralph.sh picks highest priority unblocked story",
        "Backward compatible with existing prd.json format"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/ralph.sh",
        "scripts/ralph/prd.json"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-002",
      "title": "Circuit Breakers & Iteration Limits",
      "description": "Add configurable limits to prevent infinite loops and detect stuck states",
      "priority": 1,
      "source": "ralph-orchestrator (Mikey O'Brien), Geoffrey Huntley",
      "acceptanceCriteria": [
        "MAX_ITERATIONS env var sets default limit (default: 10)",
        "MAX_CONSECUTIVE_FAILURES env var stops after N failures (default: 3)",
        "RALPH_WARN_AT env var triggers warning (default: 8)",
        "Stuck-state detection: same story failing 3+ times triggers escalation",
        "Graceful exit with summary and analysis when limit reached",
        "Optional model-specific limits via RALPH_MODEL_LIMIT_*",
        "Output analysis on stuck states for human intervention"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/ralph.sh",
        "scripts/ralph/modules/circuit-breaker.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-003",
      "title": "Multi-Layered Quality Gates",
      "description": "Post-iteration quality validation with blocking capability",
      "priority": 1,
      "source": "Gordon Mickel, Hamel Husain",
      "acceptanceCriteria": [
        "modules/quality-gates.sh validates code by language",
        "Supports: TypeScript (tsc), Python (pyright/ruff), Go, Rust, JSON, YAML",
        "Enabled via RALPH_QUALITY_GATES=1",
        "Non-blocking by default (warns but continues)",
        "RALPH_QUALITY_GATES=strict blocks on failure until fixed",
        "Auto-run tests if test command detected in package.json/pyproject.toml",
        "Acceptance checks against prd.json criteria",
        "Gracefully skips checks for missing tools"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/quality-gates.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-004",
      "title": "Fresh Context Per Iteration",
      "description": "Ensure each iteration starts clean, re-anchoring from source files",
      "priority": 1,
      "source": "Gordon Mickel (894 likes), Geoffrey Huntley, Anthropic guidance",
      "acceptanceCriteria": [
        "Each iteration reads fresh from prd.json, progress.txt, git state",
        "No in-memory state carried between iterations",
        "Agent receives current file states, not cached versions",
        "Clear iteration boundaries in logging",
        "Optional context summary injection from progress.txt patterns section"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/ralph.sh",
        "scripts/ralph/prompt.md"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-005",
      "title": "Structured Cumulative Learning",
      "description": "Standardize progress.txt format so learnings compound across iterations",
      "priority": 1,
      "source": "Matt Pocock (2.4k likes), Arvid Kahl (1.6k likes)",
      "acceptanceCriteria": [
        "prompt.md specifies exact progress.txt format",
        "Format includes: date, story ID, changes, learnings, gotchas",
        "Codebase Patterns section at TOP for cross-iteration memory",
        "Agent MUST read patterns section before starting work",
        "Failures become documented learnings (not just errors)",
        "Template provided in templates/progress-template.txt"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/prompt.md",
        "scripts/ralph/templates/progress-template.txt"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-006",
      "title": "PRD Auto-Generation & Breakdown",
      "description": "Automatically generate and break down PRD into atomic user stories",
      "priority": 1,
      "source": "Greg Isenberg (2.7k likes), Matt Pocock (4.6k likes)",
      "acceptanceCriteria": [
        "modules/prd-generator.sh takes high-level feature description",
        "Generates prd.json with atomic stories (one feature per story)",
        "Each story has clear acceptance criteria",
        "Stories scoped small enough to converge in 1-3 iterations",
        "Optional: AI-assisted breakdown via agent call",
        "Enabled via: ralph.sh generate-prd 'Feature description'"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/prd-generator.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-007",
      "title": "Explicit Planning Phase",
      "description": "Separate planning from coding with plan approval gate",
      "priority": 5,
      "source": "Gordon Mickel, MIT Recursive Language Models (Alex L Zhang, 3.8k likes)",
      "acceptanceCriteria": [
        "RALPH_PLANNING_PHASE=1 enables plan-first workflow",
        "Agent generates plan in .ralph-plan.md before coding",
        "Plan reviewed against requirements before implementation",
        "Optional: Agent self-reviews plan catching logical issues early",
        "Plan approval can be auto or manual via RALPH_PLAN_APPROVAL=auto|manual",
        "Planning phase separate from execution phase"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/planner.sh",
        "scripts/ralph/prompt.md"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-008",
      "title": "Adversarial Feedback Loops",
      "description": "Optional coach-player or multi-agent review for robustness",
      "priority": 5,
      "source": "Bitstein, Robert Youssef (364 likes), Block AI paper, MIT studies",
      "acceptanceCriteria": [
        "RALPH_ADVERSARIAL=1 enables adversarial review",
        "After implementation, second agent/model critiques output",
        "Critique focuses on: edge cases, security, logic errors",
        "Can use same agent with 'critic' persona or different model",
        "RALPH_REVIEWER_CMD allows custom reviewer agent",
        "Reduces hallucinations by 10-25% per research"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/reviewer.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-009",
      "title": "Parallel Loop Execution",
      "description": "Run multiple agents on independent features simultaneously via git worktrees",
      "priority": 5,
      "source": "Ian Nuttall (1k likes), frankbria/parallel-cc",
      "acceptanceCriteria": [
        "RALPH_PARALLEL=1 enables parallel execution",
        "modules/parallel.sh creates git worktrees for each parallel task",
        "Tasks with no dependencies can run simultaneously",
        "Each worktree has isolated context (no conflicts)",
        "Results merged back to main branch on completion",
        "Coordination via file locks or simple messaging"
      ],
      "passes": true,
      "effort": "large",
      "files": [
        "scripts/ralph/modules/parallel.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-010",
      "title": "Checkpoint/State Persistence",
      "description": "Save state for long sessions, recovery, and overnight runs",
      "priority": 5,
      "source": "multi-agent-ralph-loop, community patterns",
      "acceptanceCriteria": [
        "modules/checkpoint.sh saves current state to .ralph-checkpoint.json",
        "State includes: current iteration, last completed story, timestamp, failures",
        "RALPH_CHECKPOINT=1 enables auto-checkpoint every N iterations",
        "ralph.sh --resume continues from checkpoint",
        "Checkpoint cleared on successful completion",
        "Human can review checkpoint file for debugging"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/checkpoint.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-011",
      "title": "Persistent Memory Cache",
      "description": "Cache rarely-changing data like coding standards for efficiency",
      "priority": 5,
      "source": "Aurimas Griciunas (400 likes) on RAG+CAG fusion, Letta_AI (183 likes)",
      "acceptanceCriteria": [
        ".ralph-cache/ directory stores cold data (coding standards, rules)",
        "Cache injected into context without recomputing",
        "RALPH_CACHE=1 enables caching",
        "Separate cache for: patterns, rules, common errors",
        "Cache invalidation on manual clear or TTL",
        "Reduces token costs for repeated context"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/modules/cache.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-012",
      "title": "Cost Controls & Phase Chaining",
      "description": "Budget limits and multi-stage workflow support",
      "priority": 5,
      "source": "ralph-orchestrator, Geoffrey Huntley ($297 for $50k project case study)",
      "acceptanceCriteria": [
        "RALPH_MAX_COST env var sets budget limit (requires API cost tracking)",
        "Iteration caps matched to task type (quick: 5, standard: 10, complex: 25)",
        "Rate limiting option via RALPH_RATE_LIMIT=N (iterations per minute)",
        "Phase chaining: data \u2192 API \u2192 UI with verification between stages",
        "Cost estimate output at end of run"
      ],
      "passes": true,
      "effort": "medium",
      "files": [
        "scripts/ralph/ralph.sh",
        "scripts/ralph/modules/cost-control.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-013",
      "title": "Real-Time Monitoring Dashboard",
      "description": "View iteration progress without interrupting the loop",
      "priority": 9,
      "source": "frankbria/ralph-claude-code, Dan (38 likes)",
      "acceptanceCriteria": [
        "RALPH_MONITOR=1 enables real-time output streaming",
        "modules/monitor.sh provides tmux-based dashboard option",
        "Activity stream shows: current iteration, story, status",
        "Log tailing for long overnight runs",
        "Optional notification on completion/failure via RALPH_NOTIFY"
      ],
      "passes": false,
      "effort": "small",
      "files": [
        "scripts/ralph/modules/monitor.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "pending"
    },
    {
      "id": "US-014",
      "title": "Git Safety Guard Module",
      "description": "Optional protection against destructive git commands",
      "priority": 5,
      "source": "multi-agent-ralph-loop",
      "acceptanceCriteria": [
        "modules/git-guard.sh blocks dangerous commands",
        "Blocks: git reset --hard, git push --force, git clean -f, git branch -D",
        "Enabled via RALPH_GIT_GUARD=1",
        "Outputs clear warning when blocking",
        "Bypass with RALPH_GIT_GUARD_BYPASS=1 for intentional use"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/modules/git-guard.sh",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-015",
      "title": "Multi-Agent Support",
      "description": "Clean support for different AI agents with presets",
      "priority": 5,
      "source": "User requirement: keep Codex CLI compatibility",
      "acceptanceCriteria": [
        "RALPH_AGENT=codex|claude|aider|custom env var",
        "Pre-configured commands for popular agents",
        "Custom agent via RALPH_AGENT_CMD (existing behavior)",
        "Agent-specific iteration limits respected",
        "Agent-specific prompt adjustments if needed"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-016",
      "title": "Tool & Hook Integration",
      "description": "Allow agent to access external resources autonomously",
      "priority": 9,
      "source": "Boris Cherny (1.1k likes), Anthropic docs (4.8k likes by Alex Finn)",
      "acceptanceCriteria": [
        "RALPH_ALLOW_EXTERNAL=1 enables external tool access",
        "Support for MCP-style tool connections",
        "Permission bypass in sandboxes via --dangerously-skip-permissions pattern",
        "Pre/post iteration hooks via RALPH_PRE_HOOK and RALPH_POST_HOOK",
        "Hook scripts can query external APIs, databases, etc."
      ],
      "passes": false,
      "effort": "medium",
      "files": [
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "pending"
    },
    {
      "id": "US-017",
      "title": "Enhanced Prompt Template",
      "description": "Improve prompt.md with community-proven best practices",
      "priority": 1,
      "source": "Community consensus",
      "acceptanceCriteria": [
        "Clear step-by-step task flow",
        "Explicit quality criteria per task",
        "Gotchas section with common patterns",
        "Fresh context anchoring instructions",
        "Stop condition clearly defined",
        "Works with Codex CLI and Claude Code"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/prompt.md",
        "scripts/ralph/templates/prompt-template.md"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-018",
      "title": "Templates & Init Command",
      "description": "Provide starter templates for new Ralph projects",
      "priority": 5,
      "source": "Usability improvement",
      "acceptanceCriteria": [
        "templates/prd-template.json with example atomic stories",
        "templates/prompt-template.md with best practices",
        "templates/progress-template.txt with format guide",
        "ralph.sh init command copies templates to scripts/ralph/",
        "Quick start in under 5 minutes"
      ],
      "passes": true,
      "effort": "small",
      "files": [
        "scripts/ralph/templates/prd-template.json",
        "scripts/ralph/templates/prompt-template.md",
        "scripts/ralph/templates/progress-template.txt",
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "completed"
    },
    {
      "id": "US-019",
      "title": "Clear Output and Logging",
      "description": "Better visibility into loop execution",
      "priority": 5,
      "source": "Usability improvement",
      "acceptanceCriteria": [
        "Iteration banner with count and status",
        "Story being worked on clearly displayed",
        "Quality gate results (when enabled) shown",
        "Summary at end: iterations, completed stories, time, cost estimate",
        "Failure analysis for stuck states",
        "Optional verbose mode via RALPH_VERBOSE=1",
        "Log file output via RALPH_LOG=<file>"
      ],
      "passes": false,
      "effort": "small",
      "files": [
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "pending"
    },
    {
      "id": "US-020",
      "title": "Test-Driven Loop Mode",
      "description": "Run loop until all tests pass rather than story-based",
      "priority": 9,
      "source": "Alternative workflow pattern",
      "acceptanceCriteria": [
        "RALPH_MODE=tests runs until test suite passes",
        "Detects test framework from project files",
        "Each iteration focuses on fixing failing tests",
        "Progress tracked by test count (passing/total)",
        "Works alongside or instead of story-based mode"
      ],
      "passes": false,
      "effort": "medium",
      "files": [
        "scripts/ralph/ralph.sh"
      ],
      "dependencies": [],
      "status": "pending"
    }
  ],
  "implementationPlan": {
    "phase1": {
      "name": "Core Loop Hardening",
      "stories": [
        "US-001",
        "US-002",
        "US-004",
        "US-019"
      ],
      "description": "Enhance main loop with better task handling, circuit breakers, fresh contexts, and output",
      "priority": "immediate"
    },
    "phase2": {
      "name": "Quality & Learning",
      "stories": [
        "US-003",
        "US-005",
        "US-017"
      ],
      "description": "Add quality gates, structured learning, and improved prompts",
      "priority": "high"
    },
    "phase3": {
      "name": "PRD & Planning",
      "stories": [
        "US-006",
        "US-007",
        "US-018"
      ],
      "description": "PRD auto-generation, planning phase, and templates",
      "priority": "high"
    },
    "phase4": {
      "name": "Safety & Persistence",
      "stories": [
        "US-010",
        "US-014",
        "US-015"
      ],
      "description": "Checkpointing, git safety, and multi-agent support",
      "priority": "medium"
    },
    "phase5": {
      "name": "Advanced Features",
      "stories": [
        "US-008",
        "US-011",
        "US-012"
      ],
      "description": "Adversarial review, caching, cost controls",
      "priority": "medium"
    },
    "phase6": {
      "name": "Scaling & Extras",
      "stories": [
        "US-009",
        "US-013",
        "US-016",
        "US-020"
      ],
      "description": "Parallel execution, monitoring, hooks, test-driven mode",
      "priority": "low"
    }
  },
  "codeComparison": {
    "loopSize": {
      "multiAgentRalphLoop": "~500+ lines across multiple files",
      "currentRalph": "~70 lines",
      "ralphV2Target": "~200 lines main loop + ~400 lines optional modules"
    },
    "dependencies": {
      "multiAgentRalphLoop": "Claude Code CLI, jq, curl, WorkTrunk, gh, pyright, ruff, many others",
      "currentRalph": "bash, git, jq (optional)",
      "ralphV2Target": "bash, git, jq (optional), language tools (optional per module)"
    },
    "agentSupport": {
      "multiAgentRalphLoop": "Claude Code primary, Codex/Gemini/MiniMax secondary",
      "currentRalph": "Codex CLI primary, any via RALPH_AGENT_CMD",
      "ralphV2Target": "Any agent via config, Codex/Claude/Aider preconfigured"
    },
    "circuitBreakers": {
      "multiAgentRalphLoop": "Limited",
      "currentRalph": "None",
      "ralphV2Target": "Full: iteration limits, consecutive failures, stuck detection"
    }
  },
  "environmentVariables": {
    "core": {
      "MAX_ITERATIONS": "Maximum iterations (default: 10)",
      "MAX_CONSECUTIVE_FAILURES": "Stop after N consecutive failures (default: 3)",
      "RALPH_AGENT": "Agent preset: codex|claude|aider|custom",
      "RALPH_AGENT_CMD": "Custom agent command (overrides RALPH_AGENT)",
      "RALPH_VERBOSE": "Enable verbose output (0|1)",
      "RALPH_LOG": "Log file path"
    },
    "modules": {
      "RALPH_QUALITY_GATES": "Enable quality gates (0|1|strict)",
      "RALPH_GIT_GUARD": "Enable git safety guard (0|1)",
      "RALPH_CHECKPOINT": "Enable checkpointing (0|1)",
      "RALPH_PLANNING_PHASE": "Enable planning phase (0|1)",
      "RALPH_ADVERSARIAL": "Enable adversarial review (0|1)",
      "RALPH_PARALLEL": "Enable parallel execution (0|1)",
      "RALPH_CACHE": "Enable persistent cache (0|1)",
      "RALPH_MONITOR": "Enable real-time monitoring (0|1)"
    },
    "controls": {
      "RALPH_MAX_COST": "Budget limit (requires cost tracking)",
      "RALPH_RATE_LIMIT": "Iterations per minute limit",
      "RALPH_WARN_AT": "Warning threshold iteration count",
      "RALPH_MODE": "Execution mode: stories|tests"
    }
  },
  "migrationGuide": {
    "existingUsers": [
      "Existing prd.json files work unchanged (backward compatible)",
      "Add priority/dependencies fields incrementally",
      "Enable modules via env vars as needed",
      "No breaking changes to ralph.sh invocation"
    ],
    "fromMultiAgentRalphLoop": [
      "Ralph 2.0 is intentionally simpler - not a direct port",
      "Copy quality-gates logic but simplify",
      "Ignore Claude Code specific features",
      "Use templates to recreate workflow"
    ],
    "quickStart": [
      "1. Clone/copy scripts/ralph/ to your project",
      "2. Run: ralph.sh init (creates templates)",
      "3. Edit prd.json with your stories",
      "4. Run: ralph.sh 10 (10 iterations max)",
      "5. Enable modules as needed via env vars"
    ]
  },
  "successMetrics": [
    "Main loop stays under 250 lines",
    "Zero required dependencies beyond bash/git",
    "Works with codex, claude, aider, and custom agents",
    "Existing projects upgrade with no changes",
    "New users can start in under 5 minutes",
    "Circuit breakers prevent runaway costs",
    "Fresh contexts prevent drift over long runs"
  ],
  "rejectedAlternatives": [
    {
      "alternative": "Port multi-agent-ralph-loop entirely",
      "reason": "Too complex, Claude Code dependent, violates simplicity goal"
    },
    {
      "alternative": "Require jq as mandatory dependency",
      "reason": "Keep zero dependencies; jq enhances but isn't required"
    },
    {
      "alternative": "Build complex orchestration framework",
      "reason": "Good prompt + simple loop + modules achieves same result"
    },
    {
      "alternative": "Global installation system",
      "reason": "Project-local is simpler and more portable"
    },
    {
      "alternative": "Always-on adversarial validation",
      "reason": "Too expensive; make it opt-in for critical code"
    }
  ],
  "references": {
    "analyzed": "https://github.com/alfredolopez80/multi-agent-ralph-loop",
    "currentImplementation": "scripts/ralph/",
    "originalConcept": "Ralph Driven Development by @GeoffreyHuntley",
    "communityPosts": {
      "mattPocock": "4.6k likes - PRD breakdown, progress logging",
      "gregIsenberg": "2.7k likes - Atomic user stories, JSON-based PRDs",
      "gordonMickel": "894 likes - Fresh contexts, quality gates",
      "arvidKahl": "1.6k likes - Cumulative learning patterns",
      "ianNuttall": "1k likes - Parallel execution via worktrees",
      "alexLZhang": "3.8k likes - MIT Recursive Language Models, planning phase",
      "aurimasGriciunas": "400 likes - RAG+CAG fusion, persistent cache",
      "borisCherny": "1.1k likes - Tool integration patterns"
    }
  }
}
