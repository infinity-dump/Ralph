# Ralph Progress Log
Started: 2024-01-15

## Codebase Patterns
- Ralph: Quality gates are opt-in and only block when RALPH_QUALITY_GATES=strict; skip checks when tools/files are missing
- Ralph: Circuit breaker module tracks iteration limits, consecutive failures, and stuck story retries
- Ralph: Normalize story selection with jq (priority/status/dependencies) and fall back gracefully when jq is missing
- Ralph: Progress entries must include explicit Gotchas and still be logged on failures
- Ralph: PRD generator should fall back to template output when agent responses are missing or invalid
- Ralph: Prompt templates should include fresh-context anchoring plus a per-iteration quality checklist
- Ralph: Inject a per-iteration context header (git state, optional Codebase Patterns) when RALPH_CONTEXT_SUMMARY=1
- Migrations: IF NOT EXISTS
- Types: Export from actions.ts

## Key Files
- db/schema.ts
- app/auth/actions.ts
---

## 2026-01-11 - US-001
- Implemented priority/status/dependency-aware story selection in `ralph.sh` and injected the selected story into the prompt.
- Updated `prd.json` stories to use numeric priority, dependencies arrays, and status fields.
- **Learnings:**
  - Normalize legacy priority strings to numeric values for backward compatibility.
  - Guard jq usage so the loop still runs when jq is unavailable.
---

## 2026-01-11 - US-002
- Implemented circuit breakers for iteration limits, consecutive failures, warnings, and stuck-story detection.
- Files changed: scripts/ralph/ralph.sh, scripts/ralph/modules/circuit-breaker.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt
- **Learnings:**
  - Use a temp prompt file and PIPESTATUS to capture agent output plus exit status reliably.
  - Reset stuck-story counters on successful iterations to avoid false escalations.
---

## 2026-01-11 - US-003
- Implemented the quality gates module with language checks, PRD validation, and optional test auto-detection.
- Files changed: scripts/ralph/modules/quality-gates.sh, scripts/ralph/ralph.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt
- **Learnings:**
  - Keep quality gates non-blocking unless strict mode is explicitly enabled.
  - Prefer local tool binaries (like node_modules/.bin/tsc) before falling back to global installs.
---

## 2026-01-11 - US-005
- Clarified progress.txt format to include explicit Gotchas and failure logging requirements.
- Files changed: scripts/ralph/prompt.md, scripts/ralph/templates/progress-template.txt
- **Learnings:**
  - Include a dedicated Gotchas section for each progress entry.
- **Gotchas:**
  - Keep Codebase Patterns at the top of progress.txt to preserve cross-iteration memory.
---

## 2026-01-11 - US-006
- Implemented a PRD generator module with template-based story breakdown and optional agent-assisted generation.
- Files changed: scripts/ralph/modules/prd-generator.sh, scripts/ralph/ralph.sh, scripts/ralph/prd.json, scripts/ralph/progress.txt, AGENTS.md
- **Learnings:**
  - Validate agent-generated PRDs as JSON and fall back to a local template when invalid.
- **Gotchas:**
  - Avoid nested heredoc delimiters that collide when embedding prompts.
---

## 2026-01-11 - US-017
- Refreshed `prompt.md` with explicit workflow, fresh-context anchoring, and quality checklist guidance.
- Added `templates/prompt-template.md` to keep new projects aligned with the improved prompt structure.
- Files changed: scripts/ralph/prompt.md, scripts/ralph/templates/prompt-template.md, scripts/ralph/progress.txt, AGENTS.md, scripts/ralph/prd.json
- **Learnings:**
  - Prompt templates should mirror the runtime prompt to keep new setups consistent.
- **Gotchas:**
  - Use distinct heredoc delimiters when embedding examples to avoid shell parsing errors.
---

## 2026-01-11 - US-004
- Added a per-iteration context header (timestamp, git state) and optional Codebase Patterns injection via RALPH_CONTEXT_SUMMARY=1.
- Enforced progress.txt presence each iteration and updated prompt guidance to treat injected context as authoritative.
- Files changed: scripts/ralph/ralph.sh, scripts/ralph/prompt.md, scripts/ralph/templates/prompt-template.md, scripts/ralph/progress.txt, AGENTS.md
- Typecheck/tests: not run (no test config found).
- **Learnings:**
  - Fresh context is clearer when the loop prepends timestamped git status and optional patterns.
- **Gotchas:**
  - Keep prompt templates in sync with prompt.md when adjusting injected context.
---
